---
import siteConfig from '../../data/siteConfig.json';

const { title, subtitle, columns } = siteConfig.sections.testimonials;
const sectionName = 'testimonials';
const gridCols = `grid grid-cols-1 md:grid-cols-${columns.variant} gap-12`;

const sectionClass = `section-${sectionName}`;
const itemClass = `${sectionName}-item`;
const bubbleClass = `${sectionName}-bubble`;
const profileClass = `${sectionName}-profile`;
const avatarClass = `${sectionName}-avatar`;
---

<section
  id="testimonials"
  class={`${sectionClass} bg-stone-200 py-20 md:py-36 testimonials-bg`}
  aria-labelledby="testimonials-heading"
>
  <div class="max-w-7xl mx-auto px-6 md:px-12">
    <div class="text-left mb-12">
      <h2
        id="testimonials-heading"
        class="text-3xl md:text-4xl font-bold text-stone-800 mb-4 font-heading"
      >
        {title}
      </h2>
    </div>
    <div class="flex flex-col md:flex-row mb-12 md:mb-16 gap-4 md:gap-8">
      <p class="text-2xl md:text-3xl text-stone-600 w-full md:w-3/4">
        {subtitle.toUpperCase()}
      </p>
      <p class="text-sm md:text-base text-stone-600 w-full md:w-1/4">
        Our students share how passing their test transformed their daily lives.
      </p>
    </div>

    <div class={gridCols} role="list" aria-label="Customer testimonials">
      {
        columns.items.map((item, index) => (
          <article
            class={`${itemClass} text-center`}
            role="listitem"
            aria-labelledby={`testimonial-${index + 1}-author`}
          >
            <div
              class={`${bubbleClass} bg-white border border-stone-200 p-8 relative mb-4 min-h-[160px] flex items-center`}
              role="complementary"
            >
              <blockquote
                class="text-black dark:text-slate-900 italic"
                cite={`#testimonial-${index + 1}`}
              >
                <span class="sr-only">Quote from {item.userProfile.name}:</span>
                <q>{item.content}</q>
              </blockquote>

              <div class="absolute -bottom-4 left-0" aria-hidden="true">
                <div class="w-0 h-0 border-r-[30px] border-r-white border-b-[30px] border-b-transparent" />
              </div>
            </div>

            <div class={`${profileClass} flex items-center space-x-4 pl-6`}>
              <img
                src={`${import.meta.env.BASE_URL}${item.userProfile.photo}`}
                alt={`Portrait of ${item.userProfile.name}`}
                class={`${avatarClass} w-16 h-16 rounded-full object-cover border-2 border-amber-700`}
                loading="lazy"
                role="img"
              />
              <div class="text-left">
                <h3
                  id={`testimonial-${index + 1}-author`}
                  class="font-semibold text-black dark:text-slate-900 font-heading"
                >
                  {item.userProfile.name}
                </h3>
                <p class="text-sm text-gray-600 dark:text-stone-600" role="note">
                  {item.userProfile.title}
                </p>
              </div>
            </div>
          </article>
        ))
      }
    </div>
  </div>
</section>

<style>
  @media (prefers-color-scheme: dark) {
    .testimonials-bg {
      background-color: #e7e5e4 !important;
    }
    .testimonials-bg #why-choose-heading,
    .testimonials-bg h2,
    .testimonials-bg p {
      color: #44403c !important;
    }
  }
</style>

<script src={`${import.meta.env.BASE_URL}scripts/testimonials.js`} type="module" defer></script>
